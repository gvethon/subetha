<!--
	$Id:$
	$URL: $
-->

<web-app xmlns="http://caucho.com/ns/resin"
	xmlns:resin="urn:java:com.caucho.resin"
	xmlns:cfg="urn:java:com.caucho.config"
	xmlns:jms="urn:java:com.caucho.jms"
	xmlns:ejb="urn:java:com.caucho.ejb.cfg"
	xmlns:adm="urn:java:org.subethamail.core.admin"
	xmlns:auth="urn:java:org.subethamail.core.auth"
	xmlns:ss="urn:java:org.subethamail.web.security"
	xmlns:queue="urn:java:org.subethamail.core.queue"
	xmlns:search="urn:org.subethamail.core.search"
	>

	<resin:import path="${resin.root}/conf/subetha.xml" optional="true" />
	
	<!-- Every night at 4am run cleanup -->
	<!-- ...and might as now too (in a few seconds) -->
	<resin:ScheduledTask method="#{cleanup.cleanup}" delay="10s" cron="0 4 *"/>

	<!-- Every 15 minutes run the indexer -->
	<!-- ...and might as now too (in a few seconds) -->
	<resin:ScheduledTask method="#{indexer.update}" delay="30s" period="15m"/>

	<!-- JMS -->
	<jms:JmsConnectionFactory />

	<jms:FileQueue>
		<queue:DeliveryQueue/>
		<Named>delivery</Named>
	</jms:FileQueue>

	<jms:FileQueue>
		<queue:InjectQueue/>
		<Named>inject</Named>		
	</jms:FileQueue>

<!--	<ejb:MessageBeanConfig destinationName="inject" class="org.subethamail.core.queue.InjectListener"/>-->
<!--	<ejb:MessageBeanConfig destinationName="delivery" class="org.subethamail.core.queue.DeliveryListener"/>-->

	<ejb-message-bean class="org.subethamail.core.queue.DeliveryListener">
		<destination>#{delivery}</destination>
	</ejb-message-bean>
	<ejb-message-bean class="org.subethamail.core.queue.InjectListener">
		<destination>#{inject}</destination>
	</ejb-message-bean>

	<ejb-server data-source="jdbc/subetha"
		validate-database-schema="true" create-database-schema="true" />
<!---->
<!--	<servlet-mapping url-pattern="/api/AccountMgr" servlet-class="org.subethamail.core.acct.AccountMgrBean">-->
<!--		<protocol uri="hessian:"/>-->
<!--	</servlet-mapping>-->
<!--	<servlet-mapping url-pattern="/api/Admin" servlet-class="org.subethamail.core.admin.AdminBean">-->
<!--		<protocol uri="hessian:"/>-->
<!--	</servlet-mapping>-->
<!--	<servlet-mapping url-pattern="/api/ListWizard" servlet-class="org.subethamail.core.admin.ListWizardBean">-->
<!--		<protocol uri="hessian:"/>-->
<!--	</servlet-mapping>-->
<!--	<servlet-mapping url-pattern="/api/Injector" servlet-class="org.subethamail.core.injector.InjectorBean">-->
<!--		<protocol uri="hessian:"/>-->
<!--	</servlet-mapping>-->
<!--	<servlet-mapping url-pattern="/api/Archiver" servlet-class="org.subethamail.core.lists.ArchiverBean">-->
<!--		<protocol uri="hessian:"/>-->
<!--	</servlet-mapping>-->
<!--	<servlet-mapping url-pattern="/api/ListMgr" servlet-class="org.subethamail.core.lists.ListMgrBean">-->
<!--		<protocol uri="hessian:"/>-->
<!--	</servlet-mapping>-->
<!--	<servlet-mapping url-pattern="/api/Indexer" servlet-class="org.subethamail.core.search.IndexerBean">-->
<!--		<protocol uri="hessian:"/>-->
<!--	</servlet-mapping>-->
<!--	<servlet-mapping url-pattern="/api/EegorBringMeAnotherBrain" servlet-class="org.subethamail.core.admin.EegorBringMeAnotherBrainBean">-->
<!--		<protocol uri="hessian:"/>-->
<!--	</servlet-mapping>		-->
</web-app>
