<!--
	$Id:$
	$URL: $
-->

<web-app xmlns="http://caucho.com/ns/resin"
	xmlns:resin="urn:java:com.caucho.resin"	xmlns:cfg="urn:java:com.caucho.config"
	xmlns:jms="urn:java:com.caucho.jms"		xmlns:ejb="urn:java:com.caucho.ejb.cfg"
	xmlns:admin="urn:java:org.subethamail.core.admin"
	xmlns:account="urn:java:org.subethamail.core.acct"
	xmlns:auth="urn:java:org.subethamail.core.auth"
	xmlns:sec="urn:java:org.subethamail.web.security"
	xmlns:queue="urn:java:org.subethamail.core.queue"
	xmlns:search="urn:org.subethamail.core.search"
	xmlns:injector="urn:org.subethamail.core.injector"
	xmlns:lists="urn:org.subethamail.core.lists"
	>

	<resin:import path="${resin.root}/conf/subetha.xml" optional="true" />
	
	<!-- Every night at 4am run cleanup, and in a few seconds for good measure -->
	<resin:ScheduledTask method="#{cleanup.cleanup}" delay="10s" cron="0 4 *"/>

	<!-- Every 15 minutes run the indexer, and in a few seconds for good measure -->
	<resin:ScheduledTask method="#{indexer.update}" delay="30s" period="15m"/>

	<ejb-server data-source="jdbc/subetha" validate-database-schema="true" create-database-schema="true" />

	<!-- JMS -->
	<jms:JmsConnectionFactory />
	
	<jms:FileQueue name="delivery">	<queue:DeliveryQueue/> 	</jms:FileQueue>
	<jms:FileQueue name="inject">	<queue:InjectQueue/>	</jms:FileQueue>

	<ejb-message-bean class="org.subethamail.core.queue.DeliveryListener" 	destination="#{delivery}"/>
	<ejb-message-bean class="org.subethamail.core.queue.InjectListener" 	destination="#{inject}"/>

<!--	<queue:DeliveryListener> 	<resin:JmsListener destination="delivery"/> </queue:DeliveryListener>-->
<!--	<queue:InjectListener> 		<resin:JmsListener destination="inject"/> 	</queue:InjectListener>-->

	<!-- 					Hessian Servlets 						-->
<!--	<account:AccountMgrBean> 					<resin:HessianService urlPattern="/api/AccountMgr"/> 	</account:AccountMgrBean>-->
<!--	<admin:AdminBean>							<resin:HessianService urlPattern="/api/Admin"/>			</admin:AdminBean>	-->
<!--	<admin:ListWizardBean>						<resin:HessianService urlPattern="/api/ListWizard"/>	</admin:ListWizardBean>	-->
<!--	<admin:EegorBringMeAnotherBrainBean>		<resin:HessianService urlPattern="/api/Eegor"/>			</admin:EegorBringMeAnotherBrainBean>	-->
<!--	<injector:InjectorBean>						<resin:HessianService urlPattern="/api/Injector"/> 		</injector:InjectorBean>-->
<!--	<lists:ArchiverBean>						<resin:HessianService urlPattern="/api/Archiver"/>		</lists:ArchiverBean>	-->
<!--	<lists:ListMgrBean>							<resin:HessianService urlPattern="/api/ListMgr"/>		</lists:ListMgrBean>-->
<!--	<search:IndexerBean>						<resin:HessianService urlPattern="/api/Indexer"/>		</search:IndexerBean>-->

</web-app>
