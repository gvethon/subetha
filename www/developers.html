<html>
	<head>
		<title>SubEtha for Developers</title>
		
		<style type="text/css">
			/* <![CDATA[ */ 
			@import "http://www.tigris.org/branding/css/tigris.css"; 
			@import "http://www.tigris.org/branding/css/inst.css"; 
			/*  ]]> */
		</style>
		<link rel="stylesheet" type="text/css" href="http://www.tigris.org/branding/css/print.css" media="print" />
		<script src="http://www.tigris.org/branding/scripts/tigris.js" type="text/javascript">
		</script>
	</head>

	<body>
<div class="app">
		<h1>Setup Instructions for Development</h1>
		
		<p>
			Developer setup instructions are the same as  the regular
			<a href="install.html">install instructions</a>.  Take
			special note of the instructions below if you wish to run
			the unit tests.
		</p>

		<h2>Eclipse Setup</h2>
		
		<p>
		The 3 of the 4 core developers use <a href="http://eclipse.org/">Eclipse</a> as 
		their IDE of choice. We suggest you do as well. =)
		</p>
		
		<p>
		In order to setup Eclipse, you should first make sure to install the 
		<a href="http://subclipse.tigris.org/">Subclipse</a> plugin.
		Once you have installed that plugin. Select
		File->Import->Checkout projects from SVN. Select "Create a new
		repository location". Enter the URL for SubEtha's repository:
		http://subetha.tigris.org/svn/subetha
		</p>
		<p>Note: The default svn username and password for tigris.org are Guest with no password.</p>
		
		<p>
		Once you have the project checked out you need to define the
		location of JBOSS_HOME in Eclipse. Select Project->Properties.
		Java Build Path->Add Variable. Configure Variables->New and set
		the name to JBOSS_HOME and the folder location where you
		installed JBoss.  Now, Eclipse should properly find all the right
		libraries it needs.
		</p>
		
		<p>
		The next step is to build SubEtha. From the Java perspective,
		select Window->Show View->Ant. Right click in the Ant view and Add
		buildfiles. Then look for the top level SubEtha build file and
		add it. Once that is done, you can double click the 'deploy'
		target which will build SubEtha and install it in the right
		JBoss directory location.
		</p>

		<h3>JUnit Ant Eclipse Setup</h3>
		(Option 1)
		<p>
			In the Windows->Preferences select the Ant->Runtime node.
			Add an external jar to <blockquote>&lt;eclipse dir&gt;\plugins\org.junit&lt;version&gt;\junit.jar</blockquote>
		</p>

		<h3>Suggested Eclipse Plugins</h3>
		<p>
		<ul>
			<li>
				<strong>Check Style</strong>: <a href="http://eclipse-cs.sourceforge.net/">http://eclipse-cs.sourceforge.net/</a>
			</li>
			<li>
				<strong>Subclipse</strong>: <a href="http://subclipse.tigris.org/">http://subclipse.tigris.org/</a>
			</li>		
		</ul>
		</p>

		<h3>Linked Resources (Optional)</h3>
		<p>
			You can also setup Linked Resource support in eclipse so that you can
			edit the deployed files in JBoss. These folders can also allow direct
			editing (in eclipse) of jboss configuration files. To do this, please
			add a JBOSS_HOME variable to the workspace linked resources properties.
			These setting can be found at Window -> Preferences under the General :
			Workspace : Linked Resources section. Select New from the dialog and
			specify a name of JBOSS_HOME to the jboss home folder. The linked
			folders in the project are named "jboss-X", where X points to the
			server/default/X folder.
		</p>
			
		<p><strong>Note:</strong> You will need to refresh the linked folders each time
		you deploy. JBoss creates a new folder in deploy/tmp each time the ear is unpacked.
		</p>

		
		<h2>Startup</h2>
		<p>
			Start up JBoss.  The default web interface is 
			<a href="http://localhost:8080/se/">http://localhost:8080/se/</a>
			When SubEtha runs for the first time, it creates a site administrator
			account named <strong>root@localhost</strong>, with the password
			<strong>password</strong>.
		</p>

		<h2>Directory Layout</h2>
		<p>
			The subdirectories correspond to various components:
		</p>
		<ul>
			<li>
				appmain - Build system for the main ear archive which gets deployed
				in the appserver.  No source code, just some packaging instructions
				and some metadata.  Depends on all of the other components.
			</li>
			<li>
				common - A common jar of utility classes, shared by all components.
				Includes some constants defined for the data model.
			</li>
			<li>
				core - The core business logic, implemented as a set of session EJBs.
				There may also be some service EJBs here.  There is also a special
				component built, a sar, which contains thirdparty jars and some
				configuration instructions to JBoss.
			</li>
			<li>
				plugin - Implementation of all the plugins distributed with SubEtha.
				Note that the plugin interfaces are part of core and built into the
				core api jar.
			</li>
			<li>
				entity - The data model.  Contains EJB3 entity beans and a simple
				session EJB Data Access Object pattern.  All queries are defined here
				as well.
			</li>
			<li>
				rtest - All junit regression testing code and instructions.  JUnit
				tests are remote clients to the core ejb interface.
			</li>
			<li>
				frontend - The front end web application, packaged as a war.  Contains
				JSPs and all other content, acts as a client to the core layer.
			</li>
		</ul>
		
		<h2>Running Regression Tests</h2>
		<p>
			How to run the JUnit regression tests from ant:
		</p>
		<ul>
			<li>
				Make sure the code you want to test is deployed.  <em>ant deploy</em>
				will build the latest and deploy it.
			</li>
			<li>
				Make sure your ${jboss.dir}/server/default/deploy/mail-service.xml
				points to localhost, port 2525.  Make sure this port is free; the
				unit tests start a mock SMTP server on this port.
			</li>
			<li>
				You MUST set the system property in the JBoss JVM:
				-Dorg.subethamail.dev=true.  This causes JBoss to annotate the
				automated messages with flags that the unit tests can recognize.
				Edit ${jboss.dir}/bin/run.bat (on Windows) or ${jboss.dir}/bin/run.conf
				(Linux/Unix/MacOSX) and add this instruction to JAVA_OPTS.
			</li>
			<li>Start JBoss.  The unit tests are run against the live container.</li>
			<li>
				Run <em>ant junit</em>.  All your regression tests will run.
			</li>
			<li>
				If you want to run just one set of tests, edit the junit.special.tests
				property in your build.properties or better yet user.properties.  Then
				run the <em>ant junit-special</em> target.
			</li>
			<li>
				If you want to run the special unit test(s) in the debugger,
				run the <em>ant junit-debug</em> target.  The JVM will pause
				and wait until you attach with Eclipse.
			</li>
		</ul>
		
		<h2>Developing Filters</h2>
		
		<p>
		We have written some <a href="filter.html">intro
		documentation</a> for developing your own filters for making
		modifications to the incoming and outgoing mail streams in
		SubEtha. If you write a useful filter and you want to contribute
		it we would love to hear about it on the developers mailing list.
		</p>
		
		<h2>Mail client setup for testing</h2>
		
		<p>
		For testing of SubEtha, it is possible to easily inject email from your
		mail client directly into an instance of SubEtha. The way to do it is to
		setup a mail account in your client with a From: address of a subscriber
		on the list, the To: address is an existing list email, and the 
		outgoing mail server is the host SubEtha is running on at port 2500.
		</p>
		
		<h2>Coding Conventions</h2>
		<p>
			You may wish to read the <a href="coding.html">SubEtha Coding Conventions</a>.
		</p>
</div>
	</body>
</html>
