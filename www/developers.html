<html>
	<head>
		<title>SubEtha for Developers</title>
		
		<style type="text/css">
			/* <![CDATA[ */ 
			@import "http://www.tigris.org/branding/css/tigris.css"; 
			@import "http://www.tigris.org/branding/css/inst.css"; 
			/*  ]]> */
		</style>
		<link rel="stylesheet" type="text/css" href="http://www.tigris.org/branding/css/print.css" media="print" />
		<script src="http://www.tigris.org/branding/scripts/tigris.js" type="text/javascript">
		</script>
	</head>

	<body>
<div class="app">
		<h2>Setup Instructions for Development</h2>
		<ul>
			<li>
				Install <a href="http://labs.jboss.com/portal/jbossas/download">JBoss 4.04GA</a> 
				using the installer.  Choose the non-clustered ejb3
				install option, it boots much faster than the clustered option.  Do not
				enable call-by-value.  You do not need to secure your JBoss if you do not
				publicly expose your development server.
			</li>
			<li>
				If you install to a directory other than the default /java/jboss-VERSION,
				you will need to set the ${jboss.dir} property.  Copy build.properties to
				a file called user.properties and edit ${jboss.dir}.
			</li>
			<li>
				Edit ${jboss.dir}/server/default/deploy/mail-service.xml.  Set the
				following parameters:
				<ul>
					<li>mail.smtp.host - the name of your outgoing smtp mail server</li>
					<li>mail.smtp.port - (25) the port number of your outgoing smtp mail server</li>
					<li>mail.smtp.allow8bitmime - (true) optional, makes javamail more efficient</li>
				</ul>
				
				If you wish to run unit tests, you must have these two values:
				<ul>
					<li>mail.smtp.host set to localhost</li>
					<li>mail.smtp.port set to 2525 (you will have to create this line)</li>
				</ul>
			</li>
			<li>
				Download MySQL JDBC driver (MySQL Connector/J) from <a href="http://dev.mysql.com/downloads/">here</a>.
				Copy to ${jboss.dir}/server/default/lib.  The file should be mysql-connector-java-X.X.XX-bin.jar.
				You can use a different RDBMS but you'll need to use a different -ds.xml file
				than the one described below.
			</li>
			
			<li>
				If you need/want to support international character sets
				in Subetha, it is probably a good idea to read through
				the <a href="i18n.html">I18N configuration
				documentation</a> at this point as there are steps that
				must be completed there before going further in this
				setup.
			</li>
			<li>
				Create the data source by creating ${jboss.dir}/server/default/deploy/subetha-ds.xml.
				Use ${jboss.dir}/docs/examples/jca/mysql-ds.xml as a template.  The jndi-name must
				be SubEthaDS:
				<blockquote>&lt;jndi-name&gt;SubEthaDS&lt;/jndi-name&gt;</blockquote>
			</li>
			<li>
				One might also wish to define a database name as well. We like to use 
				the name 'subetha'. This is also defined in the subetha-ds.xml file: 
			    <blockquote>&lt;connection-url&gt;jdbc:mysql://localhost:3306/subetha&lt;/connection-url&gt;</blockquote>

			</li>
			<li>
				Create a database schema called 'subetha' which can be accessed by the host, user
				and password specified in the -ds.xml file.
			</li>
		</ul>

		<h2>Eclipse Setup</h2>
		
		<p>
		The 3 of the 4 core developers use <a href="http://eclipse.org/">Eclipse</a> as 
		their IDE of choice. We suggest you do as well. =)
		</p>
		
		<p>
		In order to setup Eclipse, you should first make sure to install the 
		<a href="http://subclipse.tigris.org/">Subclipse</a> plugin.
		Once you have installed that plugin. Select
		File->Import->Checkout projects from SVN. Select "Create a new
		repository location". Enter the URL for SubEtha's repository:
		http://subetha.tigris.org/svn/subetha
		</p>
		<p>Note: The default svn username and password for tigris.org are Guest with no password.</p>
		
		<p>
		Once you have the project checked out you need to define the
		location of JBOSS_HOME in Eclipse. Select Project->Properties.
		Java Build Path->Add Variable. Configure Variables->New and set
		the name to JBOSS_HOME and the folder location where you
		installed JBoss (ie: ${jboss.dir} mentioned above). 
		Now, Eclipse should properly find all the right
		libraries it needs.
		</p>
		
		<p>
		The next step is to build SubEtha. From the Java perspective,
		select Window->Show View->Ant. Right click in the Ant view and Add
		buildfiles. Then look for the top level SubEtha build file and
		add it. Once that is done, you can double click the 'deploy'
		target which will build SubEtha and install it in the right
		JBoss directory location.
		</p>

		<h3>Suggested Eclipse Plugins</h3>
		<p>
		<ul>
			<li>
				<strong>Check Style</strong>: <a href="http://eclipse-cs.sourceforge.net/">http://eclipse-cs.sourceforge.net/</a>
			</li>
			<li>
				<strong>Subclipse</strong>: <a href="http://subclipse.tigris.org/">http://subclipse.tigris.org/</a>
			</li>		
		</ul>
		</p>

		<h3>Linked Resources(Optional)</h3>
		<p>
			You can also setup Linked Resource support in eclipse so that you can
			edit the deployed files in JBoss. These folders can also allow direct
			editing (in eclipse) of jboss configuration files. To do this, please
			add a JBOSS_HOME variable to the workspace linked resources properties.
			These setting can be found at Window -> Preferences under the General :
			Workspace : Linked Resources section. Select New from the dialog and
			specify a name of JBOSS_HOME to the jboss home folder. The linked
			folders in the project are named "jboss-X", where X points to the
			server/default/X folder.
		</p>
			
		<p><strong>Note:</strong> You will need to refresh the linked folders each time
		you deploy. JBoss creates a new folder in deploy/tmp each time the ear is unpacked.
		</p>

		
		<h2>Startup</h2>
		<p>
			Start up JBoss.  The default web interface is 
			<a href="http://localhost:8080/se/">http://localhost:8080/se/</a>
			When SubEtha runs for the first time, it creates a site administrator
			account named <strong>root@localhost</strong>, with the password
			<strong>password</strong>.
		</p>

		<h2>Directory Layout</h2>
		<p>
			The subdirectories correspond to various components:
		</p>
		<ul>
			<li>
				appmain - Build system for the main ear archive which gets deployed
				in the appserver.  No source code, just some packaging instructions
				and some metadata.  Depends on all of the other components.
			</li>
			<li>
				common - A common jar of utility classes, shared by all components.
				Includes some constants defined for the data model.
			</li>
			<li>
				core - The core business logic, implemented as a set of session EJBs.
				There may also be some service EJBs here.  There is also a special
				component built, a sar, which contains thirdparty jars and some
				configuration instructions to JBoss.
			</li>
			<li>
				plugin - Implementation of all the plugins distributed with SubEtha.
				Note that the plugin interfaces are part of core and built into the
				core api jar.
			</li>
			<li>
				entity - The data model.  Contains EJB3 entity beans and a simple
				session EJB Data Access Object pattern.  All queries are defined here
				as well.
			</li>
			<li>
				rtest - All junit regression testing code and instructions.  JUnit
				tests are remote clients to the core ejb interface.
			</li>
			<li>
				frontend - The front end web application, packaged as a war.  Contains
				JSPs and all other content, acts as a client to the core layer.
			</li>
			<li>
				smtp - An SMTP server which allows SubEtha to receive messages
				relayed by your MTA.  This simplifies MTA integration considerably.
				This module does not depend on any SubEtha classes and could be used
				by any project needing a receptive SMTP stack.
			</li>
		</ul>
		
		<h2>Running Regression Tests</h2>
		<p>
			How to run the JUnit regression tests from ant:
		</p>
		<ul>
			<li>First make sure JBoss is running.</li>
			<li>
				Make sure the code you want to test is deployed.  <em>ant deploy</em>
				will build the latest and deploy it.
			</li>
			<li>
				Make sure your ${jboss.dir}/server/default/deploy/mail-service.xml
				points to localhost, port 2525.  Make sure this port is free; the
				unit tests start a mock SMTP server on this port.
			</li>
			<li>
				Run <em>ant junit</em>.  All your regression tests will run.
			</li>
			<li>
				If you want to run just one set of tests, edit the junit.special.tests
				property in your build.properties or better yet user.properties.  Then
				run the <em>ant junit-special</em> target.
			</li>
			<li>
				If you want to run the special unit test(s) in the debugger,
				run the <em>ant junit-debug</em> target.  The JVM will pause
				and wait until you attach with Eclipse.
			</li>
		</ul>
		
		<h2>Coding Conventions</h2>
		<p>
			You may wish to read the <a href="coding.html">SubEtha Coding Conventions</a>.
		</p>
</div>
	</body>
</html>
