<html>
	<head>
		<title>Installing SubEtha</title>
		
		<style type="text/css">
			/* <![CDATA[ */ 
			@import "http://www.tigris.org/branding/css/tigris.css"; 
			@import "http://www.tigris.org/branding/css/inst.css"; 
			/*  ]]> */
		</style>
		<link rel="stylesheet" type="text/css" href="http://www.tigris.org/branding/css/print.css" media="print" />
		<script src="http://www.tigris.org/branding/scripts/tigris.js" type="text/javascript">
		</script>
	</head>

	<body>
		<div class="app">
			<h1>How to Install SubEtha</h1>
			
			<blockquote>
				Note:  These are the full instructions for installing from scratch.  For
				an easier method, see the
				<a href="install-rtr.html">Ready To Run</a> documentation.
			</blockquote>
			
			<p>
				These instructions describe setting up a single, standalone
				instance of SubEtha.  If you wish to run a cluster you should
				consult a JBoss expert.  You should have have installed
				JDK 1.5 and whatever database you intend to use.
			</p>
			
			<ol>
				<li>
					<p>Install <a href="http://labs.jboss.com/portal/jbossas/download">JBoss 4.0.5.GA</a>
					using the JEMS 1.2.0GA installer (not the zip download!).</p>
					<ol>
						<li>Choose the ejb3-nonclustered option.</li>
						<li>Leave the configuration name as 'default'.</li>
						<li>Do not enable isolation/call-by-value.</li>
						<li>Secure all of the JMX access points.  <strong>Be sure to use a non-guessable password</strong>.</li>
					</ol>
					<p>The remaining documentation referrs to the directory in which you
					installed JBoss as ${jboss.dir}.</p>
				</li>
				<li>
					<p>Edit ${jboss.dir}/server/default/deploy/ejb3-entity-cache-service.xml and change
					this line to LOCAL:</p>
					<blockquote><pre>&lt;attribute name="CacheMode"&gt;LOCAL&lt;/attribute&gt;</pre></blockquote>
				</li>
				<li>
					<p>SubEtha uses JavaMail to send messages through an existing Mail Transport Agent
					such as Postfix or Sendmail.  Edit the configuration in
					${jboss.dir}/server/default/deploy/mail-service.xml and set the
					following parameters:</p>
					<ul>
						<li>mail.smtp.host - the name of your outgoing smtp mail server (probably "localhost")</li>
						<li>mail.smtp.port - the port number of your outgoing smtp mail server (probably 25)</li>
						<!-- JavaMail is broken with this on -->
						<!-- <li>mail.smtp.allow8bitmime - set to "true" to optionally create more efficient email.  Most modern MTAs (ie Postfix) can handle this.</li> -->
					</ul>
					<p>You will need to add the mail.smtp.port line if you wish to change from the default (25).
					Everything else in the file can be left as-is.</p>
				</li>
				<li>
					<p>Set up the JDBC data source.</p>
					<ol>
						<li>Copy an appropriate JDBC driver for your database into ${jboss.dir}/server/default/lib.
							(Download MySQL JDBC driver (MySQL Connector/J) from <a href="http://dev.mysql.com/downloads/">here</a>.)
						</li>
						<li>
							Configure <strong>two</strong> data sources appropriate to your particular database by
							copying one of the templates in ${jboss.dir}/docs/examples/jca/ into
							${jboss.dir}/server/default/deploy/.  There are examples for most modern RDBMSes.
							You can declare both data sources in the same file.  The names of the data sources
							must be <strong>SubEthaDS</strong> and <strong>SubEthaQueueDS</strong>.  Here is
							an example:
							<blockquote><pre>
&lt;datasources&gt;
  &lt;local-tx-datasource&gt;
    &lt;jndi-name&gt;SubEthaDS&lt;/jndi-name&gt;
    &lt;connection-url&gt;jdbc:mysql://localhost:3306/subetha&lt;/connection-url&gt;
    &lt;driver-class&gt;com.mysql.jdbc.Driver&lt;/driver-class&gt;
    &lt;user-name&gt;root&lt;/user-name&gt;
    &lt;password&gt;&lt;/password&gt;
    &lt;exception-sorter-class-name&gt;
    	org.jboss.resource.adapter.jdbc.vendor.MySQLExceptionSorter
    &lt;/exception-sorter-class-name&gt;
  &lt;/local-tx-datasource&gt;
  
  &lt;local-tx-datasource&gt;
    &lt;jndi-name&gt;SubEthaQueueDS&lt;/jndi-name&gt;
    &lt;connection-url&gt;jdbc:mysql://localhost:3306/subetha-q&lt;/connection-url&gt;
    &lt;driver-class&gt;com.mysql.jdbc.Driver&lt;/driver-class&gt;
    &lt;user-name&gt;root&lt;/user-name&gt;
    &lt;password&gt;&lt;/password&gt;
    &lt;exception-sorter-class-name&gt;
    	org.jboss.resource.adapter.jdbc.vendor.MySQLExceptionSorter
    &lt;/exception-sorter-class-name&gt;
  &lt;/local-tx-datasource&gt;
&lt;/datasources&gt;
</pre></blockquote>
							The filename is arbitrary but it should end with -ds.xml.
						</li>
						<li>
							Create the schemas (not the tables) that you referenced in your -ds.xml file.
							In the above example, you should create databases named "subetha" and "subetha-q"
						</li>
						<li>Note that JBoss will create the database tables for you when SubEtha runs for the first time.</li>
					</ol>
				</li>
				<li>
					<p>Copy subetha.ear to ${jboss.dir}/server/default/deploy/.</p>
				</li>
				<li>
					<p>Configure the startup scripts.  You probably want to add -Dfile.encoding=UTF-8 to
					the JAVA_OPTS environment variable (check ${jboss.dir}/bin/run.sh or run.bat).
					If you are using Linux, example scripts suitable for /etc/init.d are
					located in ${jboss.dir}/bin/.  They will require some customization for your environment.</p>
				</li>
			</ol>
			
			<h2>Integrate with your MTA</h2>
			<p>
				Read the <a href="integration.html">integration guide</a>.
			</p>
	
			<h2>Startup</h2>
			<p>
				Start up JBoss by running ${jboss.dir}/bin/run.sh or run.bat.
				The default web interface is <a href="http://localhost:8080/se/">http://localhost:8080/se/</a>.
				When SubEtha runs for the first time, it creates a site administrator
				account named "<strong>root@localhost</strong>", with the password
				"<strong>password</strong>".
			</p>
			<p>
				<strong>Change the administrator password immediately</strong>.
				This can be done from the web interface.
			</p>
			
			<p>
				You are now ready to continue with the <a href="administration.html">Administration Guide</a>.
			</p>

		</div>
	</body>
</html>